.MEXPMAPS
.A program for viewing and editing MExp maps

.Setting things up
L_1+768->S
prgmMMSTAT
ReturnIf LWOR()
ClrHomeClrDraw^r^r
0->CP
0->SX->SY
SEMD(0)
CCAS()
DSCR()

.Main loop
Repeat getKey(15)
    DGWP()

    .Movement
    If getKey(1)
        MVSL(0,1)
    ElseIf getKey(2)
        MVSL(-1,0)
    ElseIf getKey(3)
        MVSL(1,0)
    ElseIf getKey(4)
        MVSL(0,-1)
    End

    .Editor mode changing
    If getKey(53)
        SEMD(1)
    ElseIf getKey(52)
        SEMD(2)
    ElseIf getKey(51)
        SEMD(3)
    ElseIf getKey(50)
        SEMD(4)
    End

    .Actions within editor mode
    If MD=1
        .IMAP mode
    ElseIf MD=2
        .IDAT mode
    ElseIf MD=3
        .HMAP mode
        If getKey(54)
            CHHT(SX,SY,1)
            DGUP(1)
            DRSL()
        ElseIf getKey(48)
            CHHT(SX,SY,-1)
            DGUP(1)
            DRSL()
        End
    ElseIf MD=4
        .OMAP mode
        If getKey(54)
            TGWT(SX,SY)
            DGUP(1)
            DRSL()
        ElseIf getKey(48)
            TGST(SX,SY)
            DGUP(1)
            DRSL()
        ElseIf getKey(47)
            TGRK(SX,SY)
            DGUP(1)
            DRSL()
        ElseIf getKey(46)
            TGLD(SX,SY)
            DGUP(1)
            DRSL()
        End
    End
End

.Saving and exiting
ClrHome
Disp "SAVING..."
REAF()->A
If A
    ClrHome
    Disp "FAILED TO REARC"
    Repeat getKey(9)
    End
End
Return

Lbl MVSL {
    .Moves the selector by a given offset
    .r1: MoveX
    .r2: MoveY

    .Moving the selector
    SX+r_1->G
    SY+r_2->H
    If G<MW?H<MH
        G->SX
        H->SY
    End

    .Drawing to a parity of 1
    DGUP(1)

    .Redrawing the screen
    DRSL()

    Return
}

Lbl SEMD {
    .Set editor mode
    .r1: New editor mode

    r_1->MD
    0->CB
}

.(insert all other source files here)
